#! /usr/bin/octave-cli -q

# Copyright (c) 2015 Alberto Otero de la Roza <alberto@fluor.quimica.uniovi.es>
#
# refdata is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

## Choose the energy reader and name generator
# source("reader_g09.m");
source("reader_postg.m");
# source("reader_orca.m");
 
din = {"../10_din/s22.din"};
data = {"../30_run/10_kb_lcwpbe"};

## ## List of din files to process
## din  = {...
##          "../10_din/gmtkn30_aconf.din",...
##          "../10_din/gmtkn30_adim6.din",...
##          "../10_din/gmtkn30_al2x.din",...
##          "../10_din/gmtkn30_bh76.din",...
##          "../10_din/gmtkn30_bh76rc.din",...
##          "../10_din/gmtkn30_bhperi.din",...
##          "../10_din/gmtkn30_bsr36.din",...
##          "../10_din/gmtkn30_cyconf.din",...
##          "../10_din/gmtkn30_darc.din",...
##          "../10_din/gmtkn30_dc9.din",...
##          "../10_din/gmtkn30_g21ea.din",...
##          "../10_din/gmtkn30_g21ip.din",...
##          "../10_din/gmtkn30_g2rc.din",...
##          "../10_din/gmtkn30_idisp.din",...
##          "../10_din/gmtkn30_iso34.din",...
##          "../10_din/gmtkn30_mb08-165.din",...
##          "../10_din/gmtkn30_nbprc.din",...
##          "../10_din/gmtkn30_o3add6.din",...
##          "../10_din/gmtkn30_pa.din",...
##          "../10_din/gmtkn30_pconf.din",...
##          "../10_din/gmtkn30_rg6.din",...
##          "../10_din/gmtkn30_rse43.din",...
##          "../10_din/gmtkn30_s22.din",...
##          "../10_din/gmtkn30_sconf.din",...
##          "../10_din/gmtkn30_sie11.din",...
##          "../10_din/gmtkn30_w4-08.din",...
##          "../10_din/gmtkn30_water27.din",...
##        };
## 
## ## List of directories, in the same order as the din files.
## data = {
##          "../30_run/olyp%atz/gmtkn30_aconf",...
##          "../30_run/olyp%atz/gmtkn30_adim6",...
##          "../30_run/olyp%atz/gmtkn30_al2x",...
##          "../30_run/olyp%atz/gmtkn30_bh76",...
##          "../30_run/olyp%atz/gmtkn30_bh76",...
##          "../30_run/olyp%atz/gmtkn30_bhperi",...
##          "../30_run/olyp%atz/gmtkn30_bsr36",...
##          "../30_run/olyp%atz/gmtkn30_cyconf",...
##          "../30_run/olyp%atz/gmtkn30_darc",...
##          "../30_run/olyp%atz/gmtkn30_dc9",...
##          "../30_run/olyp%atz/gmtkn30_g21ea",...
##          "../30_run/olyp%atz/gmtkn30_g21ip",...
##          "../30_run/olyp%atz/gmtkn30_g2rc",...
##          "../30_run/olyp%atz/gmtkn30_idisp",...
##          "../30_run/olyp%atz/gmtkn30_iso34",...
##          "../30_run/olyp%atz/gmtkn30_mb08-165",...
##          "../30_run/olyp%atz/gmtkn30_nbprc",...
##          "../30_run/olyp%atz/gmtkn30_o3add6",...
##          "../30_run/olyp%atz/gmtkn30_pa",...
##          "../30_run/olyp%atz/gmtkn30_pconf",...
##          "../30_run/olyp%atz/gmtkn30_rg6",...
##          "../30_run/olyp%atz/gmtkn30_rse43",...
##          "../30_run/olyp%atz/gmtkn30_s22",...
##          "../30_run/olyp%atz/gmtkn30_sconf",...
##          "../30_run/olyp%atz/gmtkn30_sie11",...
##          "../30_run/olyp%atz/gmtkn30_w4-08",...
##          "../30_run/olyp%atz/gmtkn30_water27",...
##          };

#### Now DO stuff ####
warning("off");
format long;

## some checks
if (length(din) != length(data))
  error("Inconsistent data and din lengths")
endif
ndin = length(din);

for i = 1:ndin
  ## the din file exists?
  if (!exist(din{i},"file"))
    error(sprintf("din file does not exist: %s",din{i}))
  endif

  ## Process the outputs
  [n rxn] = load_din(din{i});
  [mad,md,rms,mapd,mpd,rmsp,maxad,maxadline,maxapd,maxapdline,elist,lines] = process_din(n,rxn,data{i},0);

  #### Simple output, whole list
  printf("## din file: %s\n",din{i});
  printf("## All results in kcal/mol.\n",din{i});
  printf("| name | Ref. | Calc. | \n");
  for j = 1:n
    yref = rxn{j}{end};
    printf("| %25s | %10.3f | %10.3f |\n",rxn{j}{end-1},yref,elist(j));
  endfor
  printf("| MAE  | -- | %.3f |\n",mad(1));
  printf("| ME   | -- | %.3f |\n",md(1));
  printf("| MAPE | -- | %.3f |\n",mapd(1));
  printf("| MPE  | -- | %.3f |\n",mpd(1));
  printf("| RMS  | -- | %.3f |\n",rms(1));
  printf("| RMSP | -- | %.3f |\n",rmsp(1));

  #### Simple output, only name of the set and MAE
  ## printf("| %s | %.3f |\n",din{i},mad(1));

endfor

